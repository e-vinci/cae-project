---
title: CI
description: Int√©gration continue
date: 20/01/2025
---

<InternalPageMenu>
  <PathViewer>
    <PathViewerItem to="/"> CAE </PathViewerItem>
    <PathViewerItem to="/quality"> Qualit√© </PathViewerItem>
    <PathViewerItem selected> Int√©gration Continue </PathViewerItem>
  </PathViewer>
  <InternalPageMenuItem> Cr√©ation de votre compte sous Gitlab </InternalPageMenuItem>
  <InternalPageMenuItem> Comment d√©marrer l'int√©gration continue de code au sein de Gitlab ? </InternalPageMenuItem>
  <InternalPageMenuItem> Comment mettre en place le workflow d'int√©gration continue ? </InternalPageMenuItem>
  <InternalPageMenuItem> Comment mettre en place un pipeline ? </InternalPageMenuItem>
  <InternalPageMenuItem> Comment g√©rer des t√¢ches en parall√®le dans un pipeline ? </InternalPageMenuItem>
  <InternalPageMenuItem> Comment sauvegarder des rapports dans Gitlab ? </InternalPageMenuItem>
  <InternalPageMenuItem> Est-ce que cette int√©gration continue est vraiment utile ? </InternalPageMenuItem>
</InternalPageMenu>

# <InternalPageTitle> Cr√©ation de votre compte Gitlab </InternalPageTitle>

Pour les √©tudiants Vinci, vous devez cr√©er un compte Gitlab. Ce paragraphe est donc pour vous.

**üëâ CONSIGNE** : 
1. Cr√©ez un compte sur Gitlab en vous rendant sur https://gitlab.com/users/sign_up
2. Votre `First name` et `Last name` : Vous devez indiquer vos vraies informations, notamment votre nom et pr√©nom, pour que vos enseignants puissent vous identifier.
3. Votre `Username` doit √™tre : `vinci-prenom-nom` (sans accent, sans espace, sans majuscule, sans caract√®res sp√©ciaux). Si ce nom est d√©j√† pris, vous pouvez ajouter l'ann√©e en cours √† la fin de votre username (`vinci-prenom-nom-2025` par exemple).
4. Votre `Email address` : vous devez indiquer votre adresse email personnelle **`@student.vinci.be`**!, sinon vous ne pourrez pas obtenir les services gratuits offerts par Gitlab Education.
5. Votre `Password` : Vous devez choisir un mot de passe s√©curis√©.
6. Vous devez confirmer votre adresse email en donnant le code de v√©rification que vous avez re√ßu par email.
7. Vous devez ensuite s√©lectionner un `Role` et indiquer une r√©ponse pour `I'm signing up for Gitlab because:`. Vous pouvez choisir vos r√©ponses.
- Pour **`What would you like to do?`**, vous devez choisir **`Join a project`**.
- Pour **`Who will be using GitLab?`**, vous devez choisir **`Just me`**.
8. Une fois votre compte Gitlab cr√©√©, veuillez compl√©ter ce formulaire : https://forms.office.com/e/NbJ1caZQGB

Pour les √©tudiants Vinci, afin de simplifier le suivi des groupes par les enseignants, nous vous demandons d'ajouter une photo r√©cente de vous sur votre compte Gitlab. Cette photo doit √™tre une photo de vous, de face, sans lunettes de soleil, sans chapeau, sans filtre, sans masque, sans d√©guisement, sans autre personne, sans animal, sans dessin, sans logo, sans texte, sans arri√®re-plan, sans flou, sans modification. 

**üëâ CONSIGNE** : Pour ajouter une photo √† votre compte Gitlab, veuillez suivre ces √©tapes :
1. Connectez-vous √† votre compte Gitlab.
2. Cliquez sur votre avatar en haut √† droite.
3. Cliquez sur `Edit profile`.
4. Cliquez sur `Choose file...` et choisissez votre image (la taille du fichier ne peut pas d√©passer 200 KiB ).

# <InternalPageTitle> Comment d√©marrer l'int√©gration continue de code au sein de Gitlab ? </InternalPageTitle>

Nous allons dans un premier temps d√©finir ce qu'est l'int√©gration continue, puis nous verrons comment la mettre en place au sein de Gitlab.

## D√©finition de l'int√©gration continue

L'int√©gration continue est une pratique de d√©veloppement logiciel qui consiste √† **automatiser l'int√©gration du code produit par les d√©veloppeurs dans un r√©f√©rentiel partag√©**. L'objectif est de d√©tecter et de corriger les probl√®mes d'int√©gration le plus t√¥t possible, afin de garantir une qualit√© de code constante et de faciliter le d√©ploiement continu.

## Mise en place de l'int√©gration continue avec Gitlab

Gitlab propose des fonctionnalit√©s int√©gr√©es pour mettre en place l'int√©gration continue de code. Voici les √©tapes √† suivre pour configurer l'int√©gration continue dans Gitlab :
- Prot√©ger la branche principale : pour √©viter les modifications directes sur la branche principale, il est recommand√© de prot√©ger la branche `main` ou `master` et 
d'exiger des *merge requests* pour int√©grer les modifications.
- Cr√©er un fichier `.gitlab-ci.yml` : ce fichier contient les instructions pour ex√©cuter les tests, le build et le d√©ploiement du code. Il d√©finit les *jobs* et les *stages* √† ex√©cuter lors de l'int√©gration continue.

Les param√®tres pour configurer la protection de la branche principale, la gestion des MR et des builds sont accessibles dans les param√®tres du projet, ou dans les param√®tres du groupe pour appliquer des r√®gles √† plusieurs projets. Pour les √©tudiants Vinci, ces param√®tres ont √©t√© configur√©s par vos enseignants. 
Pour pouvoir configurer ces param√®tres, vous devez avoir un r√¥le de `Maintainer` ou d'`Owner` au niveau du groupe ou projet Gitlab.

Lorsque vous cr√©ez un projet Gitlab, nous vous recommandons de configurer Gitlab afin de prot√©ger la branche principale, de configurer les *merge requests* pour qu'elles soient valid√©es par un autre membre de l'√©quipe avant d'√™tre fusionn√©es, et de configurer un pipeline d'int√©gration continue qui ex√©cute les tests unitaires et v√©rifie la qualit√© du code.

Pour les √©tudiants Vinci : 
- vos enseignants ont tent√© de param√©trer un maximum de r√®gles au niveau du groupe `2025-cae-projects`, puis d'autres r√®gles plus fines au niveau de votre projet Gitlab `cae-group-xy` se trouvant dans le groupe `2025-cae-projects`.
- vous devez avoir cr√©√© un compte Gitlab en suivant toutes les consignes donn√©es ci-dessus.
- vous recevrez un email confirmant que vous avez √©t√© ajout√© au projet ` e-vinci / cae-projects / 2025-cae-projects / cae-group-xy` avec le r√¥le de `Developer`.
- ce r√¥le de `Developer` vous permettra de cr√©er des *merge requests* et de les fusionner. Vous pouvez √©galement configurer le pipeline d'int√©gration continue pour ex√©cuter les tests et v√©rifier la qualit√© du code. 
- par contre, vous ne pourrez pas configurer les r√®gles de protection de la branche principale, ni les r√®gles de *merge requests* au niveau du groupe. Ces r√®gles ont √©t√© configur√©es par vos enseignants.

Les prochaines sections expliquent, √©tape par √©tape, comment configurer l'int√©gration continue dans Gitlab si vous aviez un r√¥le de `Maintainer` ou d'`Owner` au niveau d'un groupe Gitlab. Ces sections sont √† titre informatif pour les √©tudiants Vinci.

## üç¨ Protection de la branche principale au niveau d'un groupe

Pour les √©tudiants Vinci, vous n'avez pas de groupe √† configurer. Ce paragraphe est donc pour compr√©hension uniquement du r√¥le d'un `Maintainer` ou d'un `Owner` au niveau d'un groupe Gitlab.

Pour prot√©ger la branche principale au niveau d'un groupe Gitlab, vous pouvez suivre les √©tapes suivantes :
1. Acc√©dez aux param√®tres du projet dans Gitlab (`Settings`).
2. Cliquez sur `Repository` dans le menu de gauche.
3. Cliquez sur `Default branch`.
4. La branche principale est `main` par d√©faut (il n'y a rien √† changer)
5. Assurez que l'option `Protected` est activ√©e.
6. Cochez les options :
   - Allowed to push : `No one` 
   - Allowed to merge : `Developers + Maintainers`.
7. Cliquez sur `Save changes`.

Ainsi, les d√©veloppeurs ne pourront pas pousser directement sur la branche principale, mais devront passer par des *merge requests*.


## üç¨ Meilleure gestion des MR au niveau d'un groupe

Pour les √©tudiants Vinci, vous n'avez pas de groupe √† configurer. Ce paragraphe est donc pour compr√©hension uniquement du r√¥le d'un `Maintainer` ou d'un `Owner` au niveau d'un groupe Gitlab.

Vous pouvez configurer les *merge requests* au niveau d'un groupe Gitlab pour appliquer des r√®gles √† plusieurs projets. Voici comment configurer les *merge requests* au niveau d'un groupe :
1. Acc√©dez aux param√®tres du projet dans Gitlab (`Settings`).
2. Cliquez sur `General` dans le menu de gauche.
3. Cliquez sur `Merge requests`.
4. Cochez l'option `Pipelines must succeed
Merge requests can't be merged if the latest pipeline did not succeed or is still running.`.
5. Cochez l'option `All threads must be resolved`.
6. Cliquez sur `Save changes`.

Ainsi, les *merge requests* ne pourront pas √™tre fusionn√©es si le pipeline d'int√©gration continue a √©chou√© ou si tous les threads n'ont pas √©t√© r√©solus.

## üç¨ Cr√©ation d'un projet sous Gitlab

Pour les √©tudiants Vinci, vous ne devez pas cr√©er de Projet Gitlab. Ce paragraphe est donc pour compr√©hension uniquement du r√¥le d'un `Maintainer` ou d'un `Owner` qui doit cr√©er un projet Gitlab.

Vous pouvez cr√©er un nouveau projet `priv√©` sur Gitlab en suivant ces √©tapes :

1. Rendez-vous sur un groupe Gitlab (par exemple, https://gitlab.com/e-vinci/cae-projects/2025-cae-projects).
2. Cliquez sur `New project` en haut √† droite.
3. S√©lectionnez `Create blank project`.
4. Nommez votre projet.
5. Assurez vous que le projet est `Private`.
5. Cliquez sur `Create project`.


## üç¨ Configuration de votre projet sous Gitlab

Pour les √©tudiants Vinci, vous n'avez pas de projet √† configurer. Ce paragraphe est donc pour compr√©hension uniquement du r√¥le d'un `Maintainer` ou d'un `Owner` au niveau d'un projet Gitlab.

### Protection de la branche principale

Pour prot√©ger la branche principale, vous ne devez normalement rien changer si vous avez cr√©√© votre projet dans un groupe o√π vous avez d√©j√† prot√©g√© la branche principale. 

Pour v√©rifier que tout est en ordre, vous pouvez suivre les √©tapes suivantes :
1. Acc√©dez aux param√®tres du projet dans Gitlab (`Settings`).
2. Cliquez sur `Repository` dans le menu de gauche.
3. Cliquez sur `Protected branches`.
4. La branche principale est `main` par d√©faut (il n'y a rien √† changer)
5. Assurez que cela est s√©lectionn√© : `Protect this branch`.
   - `Allowed to merge` : `Developers + Maintainers`.
   - `Allowed to push and merge` : `No one` 

Ainsi, les d√©veloppeurs ne pourront pas pousser directement sur la branche principale, mais devront passer par des *merge requests*.

### Meilleure gestion des MR

#### Historique des commits plus propre

1. Acc√©dez aux param√®tres du projet dans Gitlab (`Settings`).
2. Cliquez sur `Merge requests` dans le menu de gauche.
3. Cochez l'option `Fast-forward merge`. 
```txt No merge commits are created.
Fast-forward merges only.
When there is a merge conflict, the user is given the option to rebase.
If merge trains are enabled, merging is only possible if the branch can be rebased without conflicts.
```
4. `Squash commits when merging` : S√©lectionnez `Do not allow`. `Squashing is never performed and the checkbox is hidden.`
5. Cliquez sur `Save changes`.

#### Approbation des MR

1. Acc√©dez aux param√®tres du projet dans Gitlab (`Settings`).
2. Cliquez sur `Merge requests` dans le menu de gauche.
3. Veuillez ajouter au moins un membre de votre √©quipe pour approuver les *merge requests* :
`Approval required` : `1` (ou plus si vous le souhaitez)
4. Cliquez sur `Save changes`.

# <InternalPageTitle> Comment mettre en place le workflow d'int√©gration continue ? </InternalPageTitle>

## Introduction 

Voici un premier workflow que nous souhaitons appliquer pour l'int√©gration continue de code dans Gitlab :

1. Un d√©veloppeur cr√©e une nouvelle feature branche √† partir de la branche principale.
2. Le d√©veloppeur travaille sur sa feature et pousse ses modifications sur la branche distante.
3. Le d√©veloppeur cr√©e une *merge request* pour fusionner sa branche avec la branche principale.
4. Un autre membre de l'√©quipe approuve la *merge request*.

Nous allons commencer par ajouter le boilerplate de votre API Spring √† votre projet Gitlab.

## Clonage de votre projet Gitlab

**üëâ CONSIGNE** : Pour les √©tudiants Vinci, veuillez cloner votre projet Gitlab sur votre machine locale.

Pour vous assurer que vous clonez votre projet Gitlab avec votre nouveau compte Gitlab, nous vous recommandons cette commande :

```bash
git clone https://<votre-username-gitlab>@gitlab.com/e-vinci/cae-projects/2025-cae-projects/cae-group-<xy>.git
```

Si vous avez plusieurs comptes `gitlab.com` sur votre machine, veuillez vous assurer que les informations d'identification de votre nouveau compte Gitlab sont utilis√©es :

```bash
cd cae-group-<xy>
git config --get user.name
git config --get user.email
```

Si vous avez besoin de changer ces informations, vous pouvez utiliser les commandes suivantes :

```bash
git config user.name "<votre-username>"
git config user.email "<votre-email>@student.vinci.be"
```

## Ajout du boilerplate de votre API Spring

Vous devriez cr√©er une nouvelle branche √† partir de la branche principale pour ajouter le boilerplate de votre API Spring. Nous vous proposons de l'appeler `api-init`.

NB : Voici un exemple de commandes pour cr√©er une nouvelle branche `api-init` √† partir de la branche principale :

```bash
git checkout main
git pull
git checkout -b api-init
```

Pour l'ajout du boilerplate de votre API Spring, vous devez avoir fait tous les tutoriels qui sont demand√©s dans la page [Qualit√© de l'API](../quality/api).
Le boilerplate de votre API Spring doit √™tre ajout√© √† la racine de votre projet Gitlab, dans un dossier nomm√© **`api`**.
Si vous avez suivi les tutoriels, vous devriez avoir un projet Spring Boot avec les d√©pendances n√©cessaires pour d√©marrer votre API. En cas de souci, vous pouvez utiliser le dossier `api` fourni dans ce repository : [cae-project-boilerplate](https://github.com/e-vinci/cae-project-boilerplate).

Pensez √† ajouter un fichier `.gitignore` √† la racine de votre projet (votre repository) pour ignorer les fichiers inutiles.

```txt
### Mac
.DS_Store
### Windows
Thumbs.db
### Linux
lost+found
.env
*.env
```

Apr√®s avoir fait ces modifications, vous devez pousser votre branche `api-init` sur votre repo distant (qui est votre projet Gitlab).

Comment cr√©er une Merge Request ? [Voir la documentation](https://docs.gitlab.com/ee/user/project/merge_requests/creating_merge_requests.html)

Sur votre projet Gitlab, vous devriez voir un bouton `Create merge request` pour cr√©er une *merge request*.


Veuillez compl√©ter le formulaire de *merge request* en indiquant les informations suivantes :
- **Title** : `Ajout du boilerplate de l'API Spring`
- **Description** : 
  ```
  Ajout du boilerplate de l'API Spring.
  ```
- **Assign to** : Assign to me
- **Reviewers** : S√©lectionnez un membre de votre √©quipe pour approuver la *merge request*.
- **Merge options** : 
  - `Delete source branch when merge request is accepted.` : Cochez cette option pour supprimer la branche `boilerplate-init` apr√®s la fusion. On garde malgr√© tout l'historique complet des commits.
- Cliquez sur `Create merge request`.


Comme nous n'avons pas encore configur√© le pipeline d'int√©gration continue pour ex√©cuter les tests et v√©rifier la qualit√© du code, il n'est pas possible de fusionner la *merge request* pour le moment, m√™me si un autre membre de l'√©quipe l'approuve.

# <InternalPageTitle> Comment mettre en place un pipeline ? </InternalPageTitle>

## C'est quoi un pipeline ?

Un pipeline est un ensemble de **jobs** qui sont ex√©cut√©s dans un ordre sp√©cifique pour automatiser le processus de construction, de test et de d√©ploiement d'une application.

Nous allons voir comment configurer un pipeline dans Gitlab pour ex√©cuter les tests unitaires et v√©rifier la qualit√© du code de notre API.

## Configuration du pipeline

Pour configurer un pipeline dans Gitlab, vous devez cr√©er un fichier **`.gitlab-ci.yml`** √† la racine de votre projet. Ce fichier contient les instructions pour ex√©cuter les diff√©rents jobs du pipeline.

A la racine de votre Projet Gitlab (dans votre repository local), dans la branche `api-init`, cr√©ez un fichier `.gitlab-ci.yml` avec le contenu suivant :

```yaml
api test:
  image: maven:3.9.9-amazoncorretto-21
  script:
    - cd api
    - mvn clean test
```

Ce fichier d√©finit un job nomm√© `api test` qui utilise l'image Docker `maven:3.9.9-amazoncorretto-21` pour ex√©cuter les tests unitaires de l'API Spring. Le script ex√©cute les commandes suivantes :
- `cd api` : se d√©place dans le dossier `api` o√π se trouve le code de l'API Spring.
- `mvn clean test` : ex√©cute tous les checks que nous avons configur√©s dans l'API Spring. Il s'agit du Checkstyle, du PMD, du CPD et des tests unitaires.

Veuillez pousser votre fichier `.gitlab-ci.yml` sur votre d√©p√¥t distant.

Maintenant que vous avez ajout√© le fichier `.gitlab-ci.yml`, vous devriez voir un pipeline se d√©clencher automatiquement √† chaque *push* sur la branche `api-init`.

## V√©rification du pipeline

Pour v√©rifier que le pipeline a √©t√© ex√©cut√©e avec succ√®s, vous pouvez acc√©der √† l'onglet `Build`, `Pipelines` de votre projet Gitlab.

L√†, vous devriez voir un pipeline avec le job `api test` qui a √©t√© ex√©cut√© avec succ√®s ou qui est toujours en cours.

Si vous cliquez sur le num√©ro du pipeline, vous pouvez voir les d√©tails de l'ex√©cution du job `api test`. Puis vous pouvez voir les logs de l'ex√©cution du job. On voit ici que tous les tests ont ex√©cut√©s avec succ√®s et que le build est r√©ussi.

Nous pensons donc que la qualit√© du commit est bonne et qu'il devrait √™tre possible de fusionner la branche `api-init` avec la branche principale. 

Cependant, il est important de demander √† un autre membre de l'√©quipe de v√©rifier le code avant de fusionner la branche. Car il est possible que m√™me si la pipeline est r√©ussie, il y ait des erreurs dans le code que seul un humain peut d√©tecter.

## Approbation de la *merge request*

Veuillez demander √† un autre membre de votre √©quipe, la personne que vous avez assign√© comme `Reviewer` √† la cr√©ation de la *merge request* (MR), de revoir et d'approuver votre MR. 

Comment approuver une MR ? [Voir la documentation](https://docs.gitlab.com/ee/user/project/merge_requests/approvals/)

En r√©sum√©, pour approuver une *merge request*, vous devriez :
1. Acc√©der √† la MR.
2. Regarder les modifications apport√©es par la MR via l'onglet `Commits`.
3. V√©rifier que le pipeline a √©t√© ex√©cut√© avec succ√®s.
4. Approuver la MR en cliquant sur le bouton `Approve`.

## Fusion de la branche `api-init` avec la branche principale

Maintenant que le pipeline a √©t√© ex√©cut√©e avec succ√®s et que la MR a √©t√© accept√©e par le `Reviewer`, vous pouvez fusionner la branche `api-init` avec la branche principale. Pour cela, il suffit que le cr√©ateur de la MR clique sur le bouton `Merge`.

Attention, une fois la MR fusionn√©e, un nouveau pipeline sera d√©clench√© pour la branche principale. Vous devez vous assurer que ce pipeline est ex√©cut√© avec succ√®s avant de continuer.

## Terminer la fusion de la branche `api-init` avec la branche principale
Tout est bien g√©r√© sur le GitLab distant.
Il reste √† terminer la fusion de la branche `api-init` avec la branche principale sur votre machine locale.
Pour ce faire, vous devez vous placer sur la branche principale et r√©cup√©rer les derni√®res modifications. Par exemple, si vous √™tes sur la branche `api-init`, vous pouvez ex√©cuter les commandes suivantes :

```bash
git checkout main
git pull
```

## R√©sum√© du workflow actuel pour l'int√©gration continue

1. Un d√©veloppeur cr√©e une nouvelle feature branche √† partir de la branche principale.
2. Le d√©veloppeur travaille sur sa feature et pousse ses modifications sur la branche distante.
3. Le pipeline d'int√©gration continue est d√©clench√© automatiquement. Si le pipeline √©choue, le d√©veloppeur doit corriger les erreurs avant de continuer.
4. Le d√©veloppeur cr√©e une *MR* pour fusionner sa branche avec la branche principale et lui assigne un `Reviewer`.
5. Un autre membre de l'√©quipe, le `Reviewer`, approuve la *MR*.
6. La *MR* est fusionn√©e avec la branche principale.

# <InternalPageTitle> Comment g√©rer des t√¢ches en parall√®le dans un pipeline ? </InternalPageTitle>

## Introduction

Comment g√©rer des t√¢ches en parall√®le dans un pipeline ? Par exemple, comment ex√©cuter les tests du frontend et de l'API en parall√®le dans un pipeline ?

En fait, dans Gitlab, vous pouvez d√©finir plusieurs jobs dans un pipeline et les ex√©cuter en parall√®le.

Si vous avez plusieurs jobs qui ne d√©pendent pas les uns des autres, vous pouvez les ex√©cuter en parall√®le pour gagner du temps.

Nous allons donc ajouter notre frontend React dans le pipeline et ex√©cuter les tests du frontend et de l'API en parall√®le.

## Ajout du boilerplate de votre frontend

Pour l'ajout du boilerplate de votre frontend, vous devez avoir fait tout ce qui est demand√© dans la page [Qualit√© du Frontend](../quality/frontend).
A la fin de ces tutoriels (le dernier s'appelle `unit-tests`), vous devriez avoir un projet React avec les d√©pendances n√©cessaires pour d√©marrer un frontend. N√©anmoins, ce frontend n'int√®gre pas la librairie MUI.

Pour vous aider, nous avons cr√©√© un boilerplate pour le frontend qui reprend les tutoriels pr√©c√©dents et qui int√®gre la librairie MUI. Vous pouvez le trouver ici : [cae-project-boilerplate](https://github.com/e-vinci/cae-project-boilerplate).

Vous devriez cr√©er une nouvelle branche √† partir de la branche principale pour ajouter le boilerplate de votre frontend React dans un dossier nomm√© **`/frontend`**. Nous vous proposons d'appeler votre nouvelle branche `frontend-init`.

## Mise √† jour du pipeline

Veuillez mettre √† jour votre fichier `.gitlab-ci.yml` pour ex√©cuter les tests du frontend et de l'API en parall√®le :

```yaml {7-13}
api test:
  image: maven:3.9.9-amazoncorretto-21
  script:
    - cd api
    - mvn clean test

frontend test:
  image: node:20
  script:
    - cd frontend
    - npm install
    - npm run lint
    - npm run coverage
```

Ce fichier d√©finit deux jobs `api test` et `frontend test` qui ex√©cutent les tests de l'API Spring et du frontend React en parall√®le.

Ici, pour le frontend, nous souhaitons d'abord ex√©cuter les tests du linter, puis les tests unitaires pour g√©n√©rer un rapport de couverture de code.

Veuillez pousser tous vos modifications sur votre repo distant.

## V√©rification du pipeline

Apr√®s avoir pouss√© vos modifications, vous devriez voir un nouveau pipeline se d√©clencher automatiquement √† chaque *push* sur la branche `frontend-init`.

Vous devriez voir deux jobs `api test` et `frontend test` qui sont ex√©cut√©s en
parall√®le.

Une fois le pipeline ex√©cut√© avec succ√®s, nous pourrions fusionner la branche `frontend-init` avec la branche principale.

Mais avant cela, nous souhaitons d√©couvrir un nouveau concept, la notion d'artefacts pour stocker les rapports de tests g√©n√©r√©s par les jobs du pipeline.

# <InternalPageTitle> Comment sauvegarder des rapports dans Gitlab ? </InternalPageTitle>

## Introduction

Dans un pipeline, il est souvent n√©cessaire de g√©n√©rer des rapports de tests, de couverture de code, de qualit√© du code, etc. Ces rapports peuvent √™tre stock√©s dans Gitlab en tant qu'artefacts pour les consulter ult√©rieurement.

Nous allons voir comment sauvegarder les rapports de tests g√©n√©r√©s par les jobs `api test` et `frontend test` dans Gitlab.

## Sauvegarde des rapports

Pour sauvegarder les rapports de tests dans Gitlab, vous devez utiliser l'option `artifacts` dans le fichier `.gitlab-ci.yml`.

Voici comment mettre √† jour votre fichier `.gitlab-ci.yml` pour sauvegarder les rapports de tests :

```yaml {6-10,19-21} showLineNumbers
api test:
  image: maven:3.9.9-amazoncorretto-21
  script:
    - cd api
    - mvn clean test
  artifacts:
    paths:
      - api/target/reports/
      - api/target/site/
      - api/target/surefire-reports/

frontend test:
  image: node:20
  script:
    - cd frontend
    - npm install
    - npm run lint
    - npm run coverage
  artifacts:
    paths:
      - frontend/coverage/
```

Ce fichier d√©finit deux jobs `api test` et `frontend test` qui ex√©cutent les tests de l'API Spring et du frontend React en parall√®le. Les rapports de tests g√©n√©r√©s par ces jobs sont sauvegard√©s dans Gitlab en tant qu'artefacts.

Pour l'API Spring, nous sauvegardons les rapports dans les dossiers `api/target/reports/`, `api/target/site/` et `api/target/surefire-reports/`. Pour le frontend React, nous sauvegardons les rapports dans le dossier `frontend/coverage/`.

Pour retrouver ces documents dans Gitlab, vous pouvez acc√©der √† l'onglet `Build`, `Pipelines` de votre projet Gitlab. Vous devriez voir un pipeline avec les jobs `api test` et `frontend test` qui ont √©t√© ex√©cut√©s avec succ√®s.

Si vous cliquez sur le num√©ro du pipeline, vous pouvez voir les d√©tails de l'ex√©cution du job `api test` ou `frontend test`. 
En cliquant sur le job, vous pouvez t√©l√©charger ou voir les artefacts g√©n√©r√©s par le job.

Pour voir les artefacts g√©n√©r√©s par le job `api test`, vous pouvez cliquer sur le job `api test` dans le pipeline. Cliquez ensuite sur le bouton `Browse` pour voir les artefacts g√©n√©r√©s par le job.

Idem pour le job `frontend test`. Allez dans le pipeline, cliquez sur le job `frontend test` et cliquez sur le bouton `Browse` pour voir les artefacts g√©n√©r√©s par le job.

## Int√©gration des changements dans la branche principale

Maintenant que vous avez ajout√© les artefacts dans votre pipeline, vous pouvez fusionner la branche `frontend-init` avec la branche principale.

Pour cela, vous devez cr√©er une *merge request* pour fusionner la branche `frontend-init` avec la branche principale. Une fois la *merge request* approuv√©e, vous pouvez cliquer sur le bouton `Merge` pour fusionner la branche `frontend-init` avec la branche principale.

N'oubliez pas de mettre √† jour votre branche principale sur votre machine locale apr√®s la fusion.

# <InternalPageTitle> Est-ce que cette int√©gration continue est vraiment utile ? </InternalPageTitle>

## Intro

Imaginons que quelqu'un vient √† changer le code du frontend ou de l'API. Il est possible que ces changements affectent le bon fonctionnement de l'application.

L'int√©gration continue permet de d√©tecter ces probl√®mes le plus t√¥t possible, en ex√©cutant automatiquement les tests et en v√©rifiant la qualit√© du code √† chaque modification du code.

Pour ce tutoriel, veuillez cr√©er un souci au niveau du frontend.

## Cr√©ation d'un souci au niveau du frontend

Vous savez qu'il est impossible de faire un `push` directement sur la branche principale. Vous devez passer par une *merge request*.

Veuillez donc cr√©er une nouvelle branche au niveau du frontend que nous allons appeler `update-login-color`.

Veuillez mettre √† jour le fichier `src/components/pages/LoginPage.tsx` pour changer la couleur du formulaire de connexion (de 'secondary.light' vers "primary.light").

```tsx {6}
return (
    <Box
      sx={{
        margin: 2,
        padding: 3,
        backgroundColor: "primary.light",
        borderRadius: 4,
        boxShadow: 2,
      }}
    >
```

Faite un `commit` et un `push` sur votre branche `update-login-color`.

## V√©rification du pipeline

Apr√®s avoir pouss√© vos modifications, vous devriez voir un nouveau pipeline se d√©clencher automatiquement √† chaque *push* sur la branche `update-login-color`.

Vous devriez voir deux jobs `api test` et `frontend test` qui sont ex√©cut√©s en parall√®le.

Et finalement, vous devriez voir que le job `frontend test` a √©chou√©. En cliquant sur le job `frontend test`, vous pouvez voir les d√©tails de l'√©chec.
Voici le message d'erreur que vous devriez voir :

```txt
eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0
/builds/e-vinci/cae-projects/2025-cae-projects/cae-xy/frontend/src/components/pages/LoginPage.tsx
  40:26  error  Replace `"primary.light"` with `'primary.light'`  prettier/prettier
‚úñ 1 problem (1 error, 0 warnings)
  1 error and 0 warnings potentially fixable with the `--fix` option.
```

On voit ici que le linter ESLint a d√©tect√© une erreur dans le fichier `src/components/pages/LoginPage.tsx`. Nous avons utilis√© des guillemets doubles au lieu de simples pour la couleur du formulaire de connexion !!!

## Correction de l'erreur

Pour corriger cette erreur, vous devez mettre √† jour le fichier `src/components/pages/LoginPage.tsx` pour changer la couleur du formulaire de connexion de `"primary.light"` vers `'primary.light'`.

```tsx {6}
return (
    <Box
      sx={{
        margin: 2,
        padding: 3,
        backgroundColor: 'primary.light',
        borderRadius: 4,
        boxShadow: 2,
      }}
    >
```

Faite un `commit` et un `push` sur votre branche `update-login-color`.

Cette fois-ci, le job `frontend test` devrait √™tre ex√©cut√© avec succ√®s ! üéâ